# FamilyBot

Telegram-бот для управления семейными задачами, расписанием и напоминаниями.

## Основные возможности

### Задачи
- Создание задач с приоритетами (срочно/неделя/потом)
- Парсинг дат из текста: `завтра`, `20 января`, `04.02`, `в пятницу`
- Парсинг упоминаний: `@тим`, `@ира` → автосвязь с людьми
- Общие задачи для семьи
- Назначение задач на конкретного человека
- Повторяющиеся задачи (ежедневно, еженедельно, ежемесячно)
- Редактирование задач через `/edit`
- История и статистика выполненных задач

### Напоминания
- Напоминания с гибким расписанием (ежедневные, еженедельные, ежемесячные)
- Напоминания привязанные к задачам (`/remind ID интервалы`)
- Редактирование напоминаний через `/editreminder`
- Повторные напоминания для срочных задач
- Кнопки "Отложить на час" / "Отложить на завтра"

### Недельное расписание
- Фиксированные события по дням недели
- Плавающие события (выбор дня на неделе)
- Напоминания за N минут до события
- Дежурства по определённым неделям месяца

### Люди
- Справочник людей с ролями (ребёнок, семья, контакт)
- Дни рождения с автоматическими напоминаниями
- Связь задач с людьми

### Машины
- Учёт автомобилей
- Напоминания о страховке и ТО

### Чек-листы
- Создание чек-листов с пунктами
- Отметка пунктов через кнопки
- Сброс всех пунктов

---

## Команды

### Задачи
| Команда | Описание |
|---------|----------|
| `/add текст` | Добавить задачу |
| `/list` | Список задач |
| `/list @тим` | Задачи связанные с Тимом |
| `/today` | Срочные задачи на сегодня |
| `/done ID` | Отметить задачу выполненной |
| `/del ID` | Удалить задачу |
| `/edit ID` | Редактировать задачу |
| `/edit ID текст Новый текст` | Изменить текст задачи |
| `/edit ID приоритет срочно` | Изменить приоритет |
| `/edit ID дата завтра` | Изменить дату |
| `/shared` | Список общих семейных задач |
| `/share ID` | Сделать задачу общей |
| `/assign ID @имя` | Назначить задачу |
| `/history` | История выполненных задач |
| `/stats` | Статистика задач |

### Напоминания
| Команда | Описание |
|---------|----------|
| `/reminders` | Список напоминаний |
| `/remind ID 1д,3ч,1ч` | Добавить напоминания к задаче |
| `/editreminder ID` | Просмотр напоминания |
| `/editreminder ID текст Новый текст` | Изменить текст |
| `/editreminder ID время 09:30` | Изменить время |

**Интервалы для `/remind`:**
- `неделя` / `1н` — за неделю
- `день` / `1д` — за день
- `3ч` / `3часа` — за 3 часа
- `час` / `1ч` — за час
- `30м` / `30мин` — за 30 минут

### Расписание
| Команда | Описание |
|---------|----------|
| `/week` | Недельное расписание |
| `/addweekly Пн 17:30 Событие` | Добавить в расписание |
| `/delweekly ID` | Удалить из расписания |
| `/floating` | Плавающие события |
| `/addfloating Сб,Вс 10:00 Событие` | Добавить плавающее |

### Люди
| Команда | Описание |
|---------|----------|
| `/people` | Список людей |
| `/addperson Имя роль ДД.ММ.ГГГГ` | Добавить человека |
| `/birthdays` | Ближайшие дни рождения |

**Роли:** `ребёнок`, `семья`, `контакт`, `партнёр`

### Машины
| Команда | Описание |
|---------|----------|
| `/autos` | Список машин |
| `/addauto Название год` | Добавить машину |
| `/insurance ID ДД.ММ.ГГГГ` | Указать дату страховки |
| `/maintenance ID ДД.ММ.ГГГГ` | Указать дату ТО |

### Чек-листы
| Команда | Описание |
|---------|----------|
| `/checklists` | Список чек-листов |
| `/checklist Название` | Открыть чек-лист |
| `/addchecklist Название` | Создать чек-лист |
| `/delchecklist ID` | Удалить чек-лист |

### Повторяющиеся задачи
| Команда | Описание |
|---------|----------|
| `/addrepeat daily 09:00 Текст` | Ежедневная задача |
| `/addrepeat weekdays 09:00 Текст` | По будням |
| `/addrepeat weekly Пн 10:00 Текст` | Еженедельная |
| `/addrepeat monthly 15 09:00 Текст` | 15-го числа каждого месяца |
| `/addrepeat monthly_nth 2 Пт 09:00 Текст` | 2-я пятница месяца |

### Служебные
| Команда | Описание |
|---------|----------|
| `/menu` | Главное меню |
| `/help` | Справка по командам |
| `/seedweek` | Заполнить расписание (demo) |
| `/seedpeople` | Добавить людей (demo) |
| `/seedautos` | Добавить машины (demo) |
| `/seedchecklists` | Создать чек-листы (demo) |
| `/seedallnodes` | Создать статусы Allnodes (demo) |

---

## Примеры использования

### Создание задачи с датой
```
/add Записаться к врачу завтра
/add Купить подарок Тиму 20 января @тим
/add Оплатить счёт 15.02
```

### Редактирование задачи
```
/edit 5                          # Показать задачу с кнопками
/edit 5 текст Новое описание
/edit 5 приоритет срочно
/edit 5 дата через неделю
```

### Напоминания к задаче
```
/remind 5 1д,1ч           # Напомнить за день и за час
/remind 5 неделя,3ч,30м   # За неделю, 3 часа и 30 минут
```

### Недельное расписание
```
/addweekly Пн 16:00 Психолог
/addweekly Ср 16:00-20:00 Тим плавание
/addfloating Сб,Вс 12:00-21:00 Лука
```

---

## Технические детали

### Стек
- Go 1.25+
- SQLite (CGO)
- telegram-bot-api/v5
- robfig/cron для расписания

### Деплой
```bash
# Сборка
go build -o familybot ./cmd/bot/

# Docker
docker build -t docker.tazhate.com/familybot:latest .
docker push docker.tazhate.com/familybot:latest

# Kubernetes
kubectl rollout restart deployment/familybot -n familybot
```

### Переменные окружения
| Переменная | Описание |
|------------|----------|
| `TELEGRAM_TOKEN` | Токен бота от @BotFather |
| `WEBHOOK_URL` | URL для webhook (https://...) |
| `ALLOWED_USERS` | Список Telegram ID через запятую |
| `DATABASE_PATH` | Путь к SQLite базе |
| `TIMEZONE` | Часовой пояс (Europe/Moscow) |

---

## Структура проекта

```
.
├── cmd/bot/          # Точка входа
├── config/           # Конфигурация
├── internal/
│   ├── bot/          # Telegram бот, команды, обработчики
│   ├── domain/       # Модели данных
│   ├── scheduler/    # Планировщик напоминаний
│   ├── service/      # Бизнес-логика
│   └── storage/      # SQLite хранилище
├── Dockerfile
├── helm/             # Helm chart для Kubernetes
└── README.md
```
