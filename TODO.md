# TODO — FamilyBot

## Критично (нужно для базового использования)

### Модель Person
- [ ] Создать таблицу `persons` (id, user_id, name, role, birthday, notes, created_at)
- [ ] role: child, family, contact, partner_child
- [ ] CRUD операции в storage
- [ ] Команда `/people` — список людей
- [ ] Команда `/addperson Тим ребёнок 12.06.2017` — добавить человека
- [ ] Связь задач с людьми (task.person_id)

### Команда /week
- [ ] Модель WeeklySchedule (day_of_week, time, title, reminder_before)
- [ ] Таблица `weekly_schedule`
- [ ] Команда `/week` — показать расписание на неделю
- [ ] Автозаполнение из конфига:
  - Пн 16:00 — Психолог
  - Пн 17:30 — Федя на спорт
  - Вт — Дежурство Allnodes
  - Ср 16:00-20:00 — Тимофей
  - Чт 15:00-18:00 — Созвон Allnodes
  - Пт 15:00 — Выезд к психологу Тима, потом ночёвка
  - Сб до 20:00 — Тимофей
  - Сб/Вс 12:00-21:00 — Лука (плавает)

### Напоминания о ДР
- [ ] При создании Person с birthday — автосоздание yearly reminder
- [ ] Напоминание за 7 дней, за 1 день, в день
- [ ] Команда `/birthdays` — ближайшие ДР
- [ ] Люди для добавления:
  - Тим 12.06.2017
  - Лука 18.09.2021
  - Ира 17.12
  - Федя 23.09

### Плавающие события
- [ ] Интерфейс для floating reminders
- [ ] Кнопки "Суббота" / "Воскресенье" для выбора
- [ ] Напоминание в пятницу: "Лука — когда в эти выходные?"
- [ ] После выбора — создать напоминание на выбранный день

### Контекстные напоминания
- [ ] Напоминание за N минут до события (reminder_before в weekly_schedule)
- [ ] "Через 30 мин созвон Allnodes"
- [ ] "В 15:00 выезд к психологу Тима"
- [ ] "Через 1 час дежурство"

---

## Важно (удобство)

### Команды /assign, /shared
- [ ] `/assign 5 Ира` — назначить задачу #5 Ире
- [ ] `/shared` — список общих семейных задач
- [ ] При создании задачи кнопка "Сделать общей"
- [ ] Уведомление партнёру о назначенной задаче

### Теги/контексты
- [ ] Парсинг тегов из текста: @ира, @тим, @работа, @дом
- [ ] Фильтрация `/list @тим` — только задачи с тегом
- [ ] Автотег при связи с Person

### Дата в задаче
- [ ] Парсинг даты из текста: "завтра", "в понедельник", "4 февраля"
- [ ] `/add помыть машину завтра` → due_date = tomorrow
- [ ] NLP для русских дат (послезавтра, через неделю, в пятницу)

### Повторные напоминания
- [ ] Если задача urgent и не выполнена — напомнить через 2 часа
- [ ] Кнопка "Отложить на час" / "Отложить на завтра"
- [ ] Счётчик напоминаний (не спамить бесконечно)

### Статусы Allnodes
- [ ] Отдельное напоминание (не в брифинге): "Напиши утренний статус"
- [ ] Утро: "Что планируешь сегодня?"
- [ ] Вечер: "Что сделал за день?"
- [ ] Кнопка "Написал" для отметки

---

## Позже (расширения)

### Модель Auto
- [ ] Таблица `autos` (id, user_id, name, year, insurance_until, maintenance_until, notes)
- [ ] Машины:
  - Ford F-150 Raptor 1gen 2014 (мой)
  - Lexus 2015 (Иры)
  - Peugeot 4008 2012 (мамы)
- [ ] Напоминания о страховке за 30, 7, 1 день
- [ ] Напоминания о ТО
- [ ] Команда `/autos` — список машин

### Чек-листы
- [ ] Таблица `checklists` (id, user_id, title, items JSON)
- [ ] Повторяемые списки без сохранения статуса
- [ ] "Перед встречей с Тимом":
  - Выспался ли он?
  - Поел ли нормально?
  - Какое настроение по словам Насти?
  - Что говорит психолог?
- [ ] Команда `/checklist Тим` — показать чек-лист

### Интеграция weekly → reminders
- [ ] Автосоздание напоминаний из weekly_schedule
- [ ] Синхронизация при изменении расписания
- [ ] Команда `/addweekly Пн 17:30 Федя спорт` — добавить в расписание

### Регулярные задачи по датам
- [ ] Дежурство Пт 2-й недели месяца
- [ ] Отчёт Apostol 4-е число каждого месяца
- [ ] Логика определения недели месяца

### Google Calendar sync
- [ ] OAuth2 авторизация
- [ ] Импорт событий
- [ ] Экспорт напоминаний в календарь

### Голосовой ввод
- [ ] Распознавание голосовых сообщений
- [ ] Telegram voice → text → задача

---

## Баги и улучшения

- [ ] Пагинация в `/list` если много задач
- [ ] Редактирование задачи (сейчас только создание/удаление)
- [ ] Редактирование напоминания
- [ ] Удаление с подтверждением
- [ ] История выполненных задач `/history`
- [ ] Статистика `/stats` — сколько выполнено за неделю/месяц

---

## Текущее расписание Дениса (для справки)

| День | Время | Что |
|------|-------|-----|
| Понедельник | 16:00 | Психолог |
| Понедельник | 17:30 | Федя на спорт |
| Вторник | — | Дежурство Allnodes |
| Среда | 16:00-20:00 | Тимофей |
| Четверг | 15:00-18:00 | Созвон Allnodes (3 часа) |
| Пятница | 15:00 выезд | Психолог Тима (16:00), потом с ночёвкой |
| Пятница 2-й недели | — | Дежурство Allnodes |
| Суббота | → 20:00 | Тимофей |
| Сб или Вс (плавает) | 12:00-21:00 | Лука |

### Ежедневно
- Утро: статус Allnodes (что планирую)
- Вечер: статус Allnodes (что сделал)

### Ежемесячно
- 4-е число: отчёт Apostol

### Дни рождения
- Тим: 12 июня 2017
- Лука: 18 сентября 2021
- Ира: 17 декабря
- Федя: 23 сентября
